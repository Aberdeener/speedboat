{% extends "base.html" %}
{% block body %}
<div class="row">
  <div class="col-lg-12">
    <h1 class="page-header">{{ guild.name }} Configuration</h1>
  </div>
</div>

<div class="row">
  <div class="col-md-12">
    <div class="panel panel-default">
      <div class="panel-heading">
        Configuration Editor
      </div>
      <div class="panel-body">
        <div id="editor"></div>
      </div>
      <div class="panel-footer">
        <button id="save" type="button" class="btn btn-success btn-circle btn-lg"><i class="fa fa-check"></i></button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ace.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/keybinding-vim.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/mode-yaml.js"></script>
<script>
  var guildID = "{{ guild.guild_id }}";

  var editor = ace.edit("editor");
  editor.setTheme("ace/theme/monokai");
  editor.getSession().setMode("ace/mode/yaml");

  $.get("/config/" + guildID + "/raw").done(function (data) {
    editor.setValue(data);
  });

  $("#save").click(function (event) {
    event.preventDefault();

    $.ajax({
      type: "POST",
      data: {"data": editor.getValue()},
      url: "/config/" + guildID + "/update"
    }).done(function (event) {
      notify('success', 'Saved Configuration');
    });
  });

</script>

{% endblock %}
